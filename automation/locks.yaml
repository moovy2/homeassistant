#################################################################
## Door Lock Automations
#################################################################

        ##########################################################
        ## Doorbell Fingerprint Unlock Front Door
        ##########################################################

- alias: Locks - doorbell fingerprint unlock front door
  id: 'locks_doorbell_fingerprint_unlock_front_door'

  triggers:
    - platform: event
      event_type: state_changed
      event_data:
        entity_id: event.front_door_camera_fingerprint

  conditions:
    - condition: state
      entity_id: lock.front_door
      state: 'locked'
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: template
      value_template: >
        {{
          not trigger.event.data.old_state.attributes.get('restored', false) and
          not trigger.event.data.old_state.state == 'unavailable' and
          trigger.event.data.new_state is not none and
          trigger.event.data.new_state.attributes.event_type == 'identified' and
          (trigger.event.data.new_state.attributes.ulp_id|default('')) != '' and
          trigger.event.data.new_state.attributes.ulp_id in ['REDACTED', 'REDACTED']
        }}

  actions:
    - action: lock.unlock
      entity_id: lock.front_door

        ##########################################################
        ## Lock Front Door After 30 Mins
        ##########################################################

- alias: Locks - Lock Front Door After 30 Mins
  id: 'locks_lock_front_door_after_30_mins'

  triggers:
    - trigger: state
      entity_id: lock.front_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: lock.front_door
      state: 'unlocked'

  actions:
    - action: lock.lock
      entity_id: lock.front_door

        ##########################################################
        ## Lock Back Door After 2 Hours
        ##########################################################

- alias: Locks - Lock Back Door After 2 Hours
  id: 'locks_lock_back_door_after_2_hours'

  triggers:
    - trigger: state
      entity_id: lock.back_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  actions:
    - action: lock.lock
      entity_id: lock.back_door

        ##########################################################
        ## Lock Basement Door After 2 hours
        ##########################################################

- alias: Locks - Lock Basement Door After 45 Mins
  id: 'locks_lock_basement_door_after_45_mins'

  triggers:
    - trigger: state
      entity_id: lock.basement_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.basement_door_opened
      state: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: lock.basement_door
      state: 'unlocked'

  actions:
    - action: lock.lock
      entity_id: lock.basement_door

        ##########################################################
        ## Lock Doors at 2a
        ##########################################################

- alias: Locks - Lock Doors at 2a
  id: 'locks_lock_back_door_at_2a'

  triggers:
    - trigger: time
      at: '02:00:00'

  conditions:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.doors
      state: 'off'

  actions:
    - action: lock.lock
      target:
        entity_id:
          - lock.front_door
          - lock.back_door
          - lock.basement_door

#################################################################
## Notifications
#################################################################

        ##########################################################
        ## Locks Low Battery Notification
        ##########################################################

- alias: Locks - Low Battery Notification
  id: 'locks_low_battery_notification'

  mode: parallel
  triggers:
    - trigger: numeric_state
      entity_id: 
          - sensor.front_door_lock_batt
          - sensor.back_door_lock_batt
          - sensor.basement_door_lock_batt
      below: 30
      for:
        hours: 1
        minutes: 0
        seconds: 0

  conditions:
    - condition: state
      entity_id: input_boolean.disable_notifications
      state: 'off'

  actions:
    - action: notify.USER1_devices
      data:
        message: "{{ trigger.to_state.attributes.friendly_name }} Low"